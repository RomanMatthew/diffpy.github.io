
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Tutorial &#8212; PDFgetX3 1.2 documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/sidebar.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Files used by PDFgetX3" href="files.html" />
    <link rel="prev" title="Quick-start guide" href="quick-start.html" /> 
  </head>
  <body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="files.html" title="Files used by PDFgetX3"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="quick-start.html" title="Quick-start guide"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PDFgetX3 1.2 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p id="index-0">In this tutorial we will convert several X-ray powder diffraction
patterns to corresponding PDFs.  Open a terminal on a Unix-based system
or a Command Prompt on Windows and navigate to the <code class="file docutils literal"><span class="pre">examples</span></code>
folder included with the PDFgetX3 distribution.  The <code class="file docutils literal"><span class="pre">examples</span></code>
folder can be found in the parent “doc” directory relative to this
document or another option is to just search your file system for
one of the input files mentioned below.
The example files are also available at
<a class="reference external" href="http://www.diffpy.org/doc/pdfgetx3/pdfgetx3-examples.zip">http://www.diffpy.org/doc/pdfgetx3/pdfgetx3-examples.zip</a>.</p>
<div class="section" id="nickel-x-ray-pdf">
<span id="index-1"></span><h2>Nickel X-ray PDF<a class="headerlink" href="#nickel-x-ray-pdf" title="Permalink to this headline">¶</a></h2>
<div class="section" id="predefined-configuration-file">
<h3>predefined configuration file<a class="headerlink" href="#predefined-configuration-file" title="Permalink to this headline">¶</a></h3>
<p>Change to the <code class="file docutils literal"><span class="pre">Ni</span></code> directory.  The file named
<code class="file docutils literal"><span class="pre">ni300mesh_300k_nor_1-5.chi</span></code> contains powder X-ray data
measured from nickel at the Advanced Photon Source beamline
6ID-D.  The file contains two columns for the 2Θ scattering
angles and X-ray intensities.  The second file
<code class="file docutils literal"><span class="pre">kapton_bgrd_300k_nor_2-3.chi</span></code> contains the background
measurement, i.e., the intensities from an empty capillary.
Finally, the <code class="file docutils literal"><span class="pre">pdfgetx3.cfg</span></code> contains a complete configuration
parameters for converting the powder pattern to a PDF.  Since all
processing parameters are already defined in the configuration file,
the first PDF calculation is very simple and involves running the
<strong class="command">pdfgetx3</strong> program with the powder data file as an argument:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 ni300mesh_300k_nor_1-5.chi
</pre></div>
</div>
<p>For the first run there should be no output on the screen,
however a new file, <code class="file docutils literal"><span class="pre">ni300mesh_300k_nor_1-5.gr</span></code> should appear
in the work directory.  We can use the <strong class="command">plotdata</strong> program,
installed with PDFgetX3, to plot the output data:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ plotdata ni300mesh_300k_nor_1-5.gr
</pre></div>
</div>
<p>This will open a graph window and start an IPython interactive session.
To exit and close the figure, type <code class="docutils literal"><span class="pre">exit()</span></code> on the IPython prompt.
Let’s run the program again, but now with a
<a class="reference internal" href="options.html#cmdoption-pdfgetx3-verbose"><code class="xref std std-option docutils literal"><span class="pre">--verbose=info</span></code></a>
option, to show more details about the program actions.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 --verbose=info ni300mesh_300k_nor_1-5.chi

INFO:checking for environment variable PDFGETX3PATH
INFO:searching for default config file /home/user/.pdfgetx3.cfg
INFO:searching for default config file .pdfgetx3.cfg
INFO:searching for default config file pdfgetx3.cfg
INFO:loaded default config file pdfgetx3.cfg
INFO:parsing config file section [DEFAULT]
INFO:set config.dataformat = twotheta
INFO:set config.backgroundfile = kapton_bgrd_300k_nor_2-3.chi
INFO:set config.outputtypes = gr
INFO:set config.wavelength = 0.142774
INFO:set config.composition = Ni
INFO:set config.qmaxinst = 26.5
INFO:set config.qmax = 26.0
INFO:set config.rmin = 0.0
INFO:set config.rmax = 30.0
INFO:set config.rstep = 0.01
INFO:finished parsing config file
INFO:processing command line options
INFO:set config.verbose = info
INFO:finished with command line options
INFO:using 1 input files from the command line.
INFO:configuring PDFGetter mode &#39;xray&#39;
INFO:calling config_xray
INFO:started PDF processing.
INFO:processing &#39;ni300mesh_300k_nor_1-5.chi&#39;
INFO:resolved output file &#39;&#39; as &#39;ni300mesh_300k_nor_1-5.gr&#39;
WARNING:ni300mesh_300k_nor_1-5.gr already exists.
WARNING:Use &quot;--force=yes&quot; or &quot;--force=once&quot; to overwrite.
INFO:elapsed time: 0.08
</pre></div>
</div>
<p>Here we can see what configuration files are searched, which of them
get loaded and what are the effective values of the processing
parameters.  Unless the <code class="xref std std-option docutils literal"><span class="pre">--verbose</span></code> option is in effect, the
program will show only messages that have either WARNING or ERROR
importance.  The warning line above indicates no output has been
written, because that file already exists.  This safety check can be
overruled with the <a class="reference internal" href="options.html#cmdoption-pdfgetx3-force"><code class="xref std std-option docutils literal"><span class="pre">--force=yes</span></code></a> option, upon
which pdfgetx3 would overwrite any existing files.</p>
<p>PDFgetX3 output files start with a header that lists all the processing
parameters and can be used as a valid configuration file with the
<a class="reference internal" href="options.html#cmdoption-pdfgetx3-c"><code class="xref std std-option docutils literal"><span class="pre">-c</span></code></a> option.  Another option, <a class="reference internal" href="options.html#cmdoption-pdfgetx3-p"><code class="xref std std-option docutils literal"><span class="pre">--plot=[iq,sq,fq,gr]</span></code></a> turns on plotting of the final PDF or of some other result.  A
side effect of the <code class="xref std std-option docutils literal"><span class="pre">--plot</span></code> option is that pdfgetx3 starts in
an interactive mode, so the user can manipulate or save the plots.  To
put it all together, we are now going to redo the original PDF and plot
its reduced total scattering function <em>F</em>(<em>Q</em>) and the PDF curve <em>G</em>(<em>r</em>).  This
time the chi file is not necessary, because the input file is already
listed in the gr file that is now used as a custom configuration:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 -c ni300mesh_300k_nor_1-5.gr --plot=fq,gr

WARNING:ni300mesh_300k_nor_1-5.gr already exists.
WARNING:Use &quot;--force=yes&quot; or &quot;--force=once&quot; to overwrite.

Variables related to PDF processing:

pdfgetter    -- PDFGetter used for calculation.
config       -- configuration data used by PDFGetter.
                See config.inputfiles for a list of inputs.
iraw         -- matrix of input raw intensities with 2 rows per file.
iq sq fq gr  -- intermediate results per each input file stored
                as matrix rows.

Functions:

tuneconfig   -- dynamically tune configuration variables.
processFiles -- process specified data files.
clearSession -- clear all elements from the inputfiles, iraw,
                iq, sq, fq and gr variables.
plotdata     -- plot all or selected columns from a text data file.
loadData     -- load all or selected columns from a text data file.
findfiles    -- search for files matching the specified patterns.

Use &quot;%pdfgetx3&quot; for a fresh run without exiting IPython.
In [1]:
</pre></div>
</div>
<p>This will open a plot figure similar to</p>
<img alt="_images/nickelfqgr.png" src="_images/nickelfqgr.png" />
<p>Because of the <a class="reference internal" href="interact.html"><span class="doc">interactive mode</span></a> implied by plotting,
the program
enters an IPython session.
The IPython environment is preloaded with several extra functions
and variables related to the PDF processing.  For example, the
<a class="reference internal" href="interact.html#interactvar-config"><code class="xref std std-interactvar docutils literal"><span class="pre">config</span></code></a> variable stores all the configuration parameters,
and its content can be displayed with the <a class="reference external" href="https://docs.python.org/3.6/library/functions.html#print" title="(in Python v3.6)"><code class="xref py py-func docutils literal"><span class="pre">print()</span></code></a>
function as</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="nb">print</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="s1">&#39;ni300mesh_300k_nor_1-5.gr&#39;</span><span class="p">,</span> <span class="s1">&#39;--plot=fq,gr&#39;</span><span class="p">]</span>
<span class="n">configfile</span> <span class="o">=</span> <span class="n">ni300mesh_300k_nor_1</span><span class="o">-</span><span class="mf">5.</span><span class="n">gr</span>
<span class="o">...</span>
<span class="n">qmax</span> <span class="o">=</span> <span class="mf">26.0</span>
<span class="o">...</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="interact.html#_interactive_.processFiles" title="_interactive_.processFiles"><code class="xref py py-func docutils literal"><span class="pre">processFiles()</span></code></a> function allows to redo the
whole calculation and plotting process for additional input files or
for new parameter values.  To plot the <em>F</em>(<em>Q</em>) and <em>G</em>(<em>r</em>)
curves calculated at <em>Q</em><sub>max</sub> = 22 Å<sup>-1</sup>, we can call
<code class="xref py py-func docutils literal"><span class="pre">processFiles()</span></code> and pass it a keyword argument for
the new qmax as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">processFiles</span><span class="p">(</span><span class="n">qmax</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>

<span class="c1"># the qmax parameter was updated to a new value, thus</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">config</span><span class="o">.</span><span class="n">qmax</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="mi">22</span>
</pre></div>
</div>
<p>There should be now two lines in each plot axis corresponding to
the results at <em>Q</em><sub>max</sub> equal 26 and 22 Å<sup>-1</sup>.  To exit the program,
type <code class="docutils literal"><span class="pre">exit()</span></code>.</p>
</div>
<div class="section" id="processing-from-scratch">
<h3>processing from scratch<a class="headerlink" href="#processing-from-scratch" title="Permalink to this headline">¶</a></h3>
<p>We have already encountered the command-line <a class="reference internal" href="options.html#cmdoption-pdfgetx3-c"><code class="xref std std-option docutils literal"><span class="pre">option</span> <span class="pre">-c</span></code></a>
for specifying a custom configuration file.  A special argument “NONE”,
will make pdfgetx3 ignore any configuration files and start up in a
default state.  We can use this feature to process the nickel PDF as if
we did not have any configuration file:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 -c NONE ni300mesh_300k_nor_1-5.chi

WARNING:Nothing to do, use &quot;-t&quot; or &quot;--plot&quot; options.
ERROR:Configuration error: wavelength not specified.
ERROR:See &quot;--help&quot; for more hints.
</pre></div>
</div>
<p>There is an error, for the wavelength is necessary to convert
the scattering angle 2Θ to momentum transfer <em>Q</em>.  The
X-ray wavelength was 0.142774 Å, which can be passed with the
<a class="reference internal" href="options.html#cmdoption-pdfgetx3-w"><code class="xref std std-option docutils literal"><span class="pre">-w,</span> <span class="pre">--wavelength</span></code></a> option:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 -c NONE ni300mesh_300k_nor_1-5.chi -w 0.142774

...
ERROR:Configuration error: Chemical composition not known.
ERROR:See &quot;--help&quot; for more hints.
</pre></div>
</div>
<p>There is still an error.  The PDF calculation needs an average
X-ray scattering factor of the material, which is obtained from
sample chemical composition.  The composition can be specified
with the <a class="reference internal" href="options.html#cmdoption-pdfgetx3-composition"><code class="xref std std-option docutils literal"><span class="pre">--composition</span></code></a> option.  The example
below uses a “\” character to indicate the command continues
on the next line.  Such syntax works in Unix terminals, but
on Windows the command has to be typed all on a single line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 -c NONE ni300mesh_300k_nor_1-5.chi -w 0.142774 \
           --composition=Ni

WARNING:Nothing to do, use &quot;-t&quot; or &quot;--plot&quot; options.
...
</pre></div>
</div>
<p>There was no error message this time, but the program complains
about a lack of action.  The pdfgetx3 program does not write any results
unless instructed by the <a class="reference internal" href="options.html#cmdoption-pdfgetx3-t"><code class="xref std std-option docutils literal"><span class="pre">-t,</span> <span class="pre">--outputtypes</span></code></a> option.
The outputtypes option recognizes the following result types:
“iq”, “sq”, “fq”, “gr”.  One or more of these type strings,
separated by a comma, can be included with the
<code class="xref std std-option docutils literal"><span class="pre">-t</span></code> option, which will produce the corresponding
output files.  An empty string, such as <code class="docutils literal"><span class="pre">-t</span> <span class="pre">&quot;&quot;</span></code>, or <code class="docutils literal"><span class="pre">-t</span> <span class="pre">NONE</span></code>
may be used to clear any outputtypes defined in the configuration file,
and avoid the unseemly file-exists warnings.</p>
<p>At this point, we will not write any output files, but will use the
<a class="reference internal" href="options.html#cmdoption-pdfgetx3-p"><code class="xref std std-option docutils literal"><span class="pre">--plot</span></code></a> option to display the calculated curves.  The
<code class="xref std std-option docutils literal"><span class="pre">--plot</span></code> accepts the same arguments as outputtypes, so to
display the <em>F</em>(<em>Q</em>) and <em>G</em>(<em>r</em>) curves we shall run</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 -c NONE ni300mesh_300k_nor_1-5.chi -w 0.142774 \
           --composition=Ni --plot=fq,gr

WARNING:qmaxinst reset to last nonzero point qmaxinst=28.0865680161
WARNING:qmax reset to the data boundary qmaxinst=28.0865680161
</pre></div>
</div>
<p>which should open the following plot window:</p>
<img alt="_images/nickelfqgrnoisy.png" src="_images/nickelfqgrnoisy.png" />
<p>The graphs look terrible.  The PDF is very noisy and the <em>F</em>(<em>Q</em>) curve
shows a sudden break at about 27 Å<sup>-1</sup>.  What happened?  The powder
intensities are inaccurate at a very top of the detector angular range.
The interactive session is setup with
<a class="reference internal" href="interact.html#interactvar-iraw"><code class="xref std std-interactvar docutils literal"><span class="pre">iraw</span></code></a>, <a class="reference internal" href="interact.html#interactvar-iq"><code class="xref std std-interactvar docutils literal"><span class="pre">iq</span></code></a>, <a class="reference internal" href="interact.html#interactvar-sq"><code class="xref std std-interactvar docutils literal"><span class="pre">sq</span></code></a>,
<a class="reference internal" href="interact.html#interactvar-fq"><code class="xref std std-interactvar docutils literal"><span class="pre">fq</span></code></a>, <a class="reference internal" href="interact.html#interactvar-gr"><code class="xref std std-interactvar docutils literal"><span class="pre">gr</span></code></a>
variables for the original raw data and intermediate results.  We
are going to plot the “iq” variable that has the input intensities
resampled on the <em>Q</em> grid.  The matplotlib function
<a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.clf.html#matplotlib.pyplot.clf" title="(in Matplotlib v2.1.1)"><code class="xref py py-func docutils literal"><span class="pre">clf()</span></code></a> clears the figure,
the iq variable is a two-row matrix with <em>Q</em> and <em>I</em> rows, and the
<a class="reference external" href="https://matplotlib.org/api/_as_gen/matplotlib.pyplot.axis.html#matplotlib.pyplot.axis" title="(in Matplotlib v2.1.1)"><code class="xref py py-func docutils literal"><span class="pre">axis()</span></code></a>
function lets us zoom to a given range:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">clf</span><span class="p">()</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">plot</span><span class="p">(</span><span class="n">iq</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">iq</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x3e20f50</span><span class="o">&gt;</span><span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">axis</span><span class="p">([</span><span class="mi">20</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">])</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">]</span>
</pre></div>
</div>
<p>The graph shows a sudden drop in the raw intensities at 27 Å<sup>-1</sup>.
The <a class="reference internal" href="options.html#confval-qmaxinst"><code class="xref std std-confval docutils literal"><span class="pre">qmaxinst</span></code></a> variable defines a <em>Q</em> cutoff for a meaningful
instrument intensities and, to be on a safe side, we are going to set
it to 26.5 Å<sup>-1</sup></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">processFiles</span><span class="p">(</span><span class="n">qmaxinst</span><span class="o">=</span><span class="mf">26.5</span><span class="p">)</span>
<span class="n">WARNING</span><span class="p">:</span><span class="n">qmax</span> <span class="n">reset</span> <span class="n">to</span> <span class="n">the</span> <span class="n">data</span> <span class="n">boundary</span> <span class="n">qmaxinst</span><span class="o">=</span><span class="mf">26.5</span>
</pre></div>
</div>
<p>The updated curves looks reasonable without any oscillations and
breakpoints.  The <a class="reference internal" href="interact.html#_interactive_.tuneconfig" title="_interactive_.tuneconfig"><code class="xref py py-func docutils literal"><span class="pre">tuneconfig()</span></code></a> function provides a
GUI-driven way for visualizing the processing parameters and their
effect on the results.  Type <code class="docutils literal"><span class="pre">tuneconfig()</span></code> to execute the function,
which should open a new window with several sliders.  Try to move
different sliders and see how do the <em>F</em>(<em>Q</em>) and <em>G</em>(<em>r</em>) curves change.
The <a class="reference internal" href="options.html#confval-rpoly"><code class="xref std std-confval docutils literal"><span class="pre">rpoly</span></code></a> parameter controls the degree of data-correction
polynomial and is an approximate low-<em>r</em> bound of reliable <em>G</em>
values.  Once the parameters are tuned, they may be set to
exact values.  We will also turn on the writing of the <em>G</em>(<em>r</em>)
curve and save it to an output file <code class="file docutils literal"><span class="pre">nicmd.gr</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">config</span><span class="o">.</span><span class="n">qmax</span> <span class="o">=</span> <span class="mi">26</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">config</span><span class="o">.</span><span class="n">outputtypes</span> <span class="o">=</span> <span class="s1">&#39;gr&#39;</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">config</span><span class="o">.</span><span class="n">output</span> <span class="o">=</span> <span class="s1">&#39;nicmd&#39;</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">processFiles</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="platinum-data-series">
<h2>Platinum data series<a class="headerlink" href="#platinum-data-series" title="Permalink to this headline">¶</a></h2>
<p>PDFgetX3 has been designed to handle large series of data files.
With the fast area-detectors it is easy to measure hundreds of X-ray
patterns in a time or temperature series.  Normally, these input
files need to be entered as command line arguments to the pdfgetx3
program.  This is usually no problem with Unix-like shells, which
expand filename patterns to a list of matching files.
However, such file generation is in general not available on Windows.
The input file names tend to include scan numbers which are useful
for selecting desired data, yet even with Unix shells it is
difficult to match a range of scan numbers
(<a class="reference external" href="http://www.zsh.org/">z-shell</a> being a notable exception).</p>
<div class="section" id="matching-input-files">
<span id="my-findexamples"></span><h3>matching input files<a class="headerlink" href="#matching-input-files" title="Permalink to this headline">¶</a></h3>
<p>The <strong class="program">pdfgetx3</strong> program includes a built-in function for finding
a set of input files.  The command line arguments are normally taken as
input file names.  However, if the <a class="reference internal" href="options.html#cmdoption-pdfgetx3-f"><code class="xref std std-option docutils literal"><span class="pre">-f,</span> <span class="pre">--find</span></code></a> option is
present, the arguments are understood as patterns and the program looks
for files that match ALL of them.  Another option
<a class="reference internal" href="options.html#cmdoption-pdfgetx3-l"><code class="xref std std-option docutils literal"><span class="pre">-l,</span> <span class="pre">--list</span></code></a> makes pdfgetx3 print out the matching files
without any other action, which can be used to verify if the patterns
match intended files.</p>
<p>We will try out this file search on platinum example files.  Open a
terminal and navigate to the <code class="file docutils literal"><span class="pre">Pt</span></code> directory.  There should be a
<code class="file docutils literal"><span class="pre">series</span></code> subdirectory with 6 chi files indexed from 903 to 908.
At first, let’s stay in the <code class="file docutils literal"><span class="pre">Pt</span></code> directory and run the following
command</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 --list --find

Pt_bulk-00055-pdfgetx2.gr
Pt_bulk-00055-pdfgetx3.gr
Pt_bulk-00055.chi
Pt_bulk-00055.gr
empty_capillary-00032.chi
pdfgetx3.cfg
plotpdfcomparison.py
</pre></div>
</div>
<p>Without any patterns the file search matches all files in the current
directory.  Now let’s try to add name patterns.  There are few special
patterns, for example <code class="docutils literal"><span class="pre">^</span></code> matches at the beginning of the filename,
<code class="docutils literal"><span class="pre">$</span></code> at the end and <code class="docutils literal"><span class="pre">&lt;N-M&gt;</span></code> matches a range of integer values from
<em>N</em> to <em>M</em>.  The patterns containing <code class="docutils literal"><span class="pre">^$&lt;&gt;</span></code> need to be quoted as
these characters have special meaning in the shell.  Here are some
examples how it works.</p>
<p>Filenames containing “y”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 --list --find y
empty_capillary-00032.chi
plotpdfcomparison.py
</pre></div>
</div>
<p>Filenames that containing both “y” and “chi”, here we use the
options <code class="xref std std-option docutils literal"><span class="pre">--list</span></code> and <code class="xref std std-option docutils literal"><span class="pre">--find</span></code> in an abbreviated
form <code class="xref std std-option docutils literal"><span class="pre">-l</span></code> and <code class="xref std std-option docutils literal"><span class="pre">-f</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 -lf y chi
empty_capillary-00032.chi
</pre></div>
</div>
<p>Filenames that start with “e”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 --list --find &quot;^e&quot;
empty_capillary-00032.chi
</pre></div>
</div>
<p>Filenames that contain <em>character</em> “2”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 --list --find 2
Pt_bulk-00055-pdfgetx2.gr
empty_capillary-00032.chi
</pre></div>
</div>
<p>Filenames that contain <em>numeric value</em> “2”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 -lf &quot;&lt;2&gt;&quot;
Pt_bulk-00055-pdfgetx2.gr
</pre></div>
</div>
</div>
<div class="section" id="data-search-path">
<h3>data search path<a class="headerlink" href="#data-search-path" title="Permalink to this headline">¶</a></h3>
<p>PDFgetX3 can be run with the <a class="reference internal" href="options.html#cmdoption-pdfgetx3-d"><code class="xref std std-option docutils literal"><span class="pre">-d,</span> <span class="pre">--datapath</span></code></a> option, which
tells it to search additional directories for input data files.  The
<code class="xref std std-option docutils literal"><span class="pre">-d</span></code> option can be used several times to search more
directories.  The data directories can be also defined with the
<span class="target" id="index-2"></span><a class="reference internal" href="files.html#envvar-PDFGETX3PATH"><code class="xref std std-envvar docutils literal"><span class="pre">PDFGETX3PATH</span></code></a> environment variable.  Here we will use
the <code class="xref std std-option docutils literal"><span class="pre">-d</span></code> option to match files in the <code class="file docutils literal"><span class="pre">series</span></code>
subdirectory.  The search stops at the first directory that contains
any match, therefore</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 --datapath=series --list --find Pt chi
Pt_bulk-00055.chi
</pre></div>
</div>
<p>matches just one file in the current working directory, but</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 --datapath=series --list --find Pt &quot;&lt;906-&gt;.chi&quot;
series/Pt_bulk_ramp03-00906.chi
series/Pt_bulk_ramp03-00907.chi
series/Pt_bulk_ramp03-00908.chi
</pre></div>
</div>
<p>finds 3 files, because only the <code class="file docutils literal"><span class="pre">series</span></code> folder contains
file names with “Pt” and a number “906” or higher followed
by “.chi”.</p>
</div>
<div class="section" id="output-file-names">
<h3>output file names<a class="headerlink" href="#output-file-names" title="Permalink to this headline">¶</a></h3>
<p>By default the output files are saved in the current directory.  The
output path, can be changed with the <a class="reference internal" href="options.html#cmdoption-pdfgetx3-o"><code class="xref std std-option docutils literal"><span class="pre">-o,</span> <span class="pre">--output</span></code></a> option.
The <code class="xref std std-option docutils literal"><span class="pre">-o</span></code> recognizes several aliases that are replaced with
parts of the input file name, for example, “&#64;b” expands to an
extension-stripped base name.  In similar faction, “&#64;o” is replaced
with the output type extension.  Thus to generate PDFs for all files
in the <code class="file docutils literal"><span class="pre">series</span></code> directory and save them in the
<code class="file docutils literal"><span class="pre">series-gr</span></code> subfolder do</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 -d series --find &quot;&lt;900-910&gt;.chi&quot; --output=series-gr/@b.@o
</pre></div>
</div>
<p>The extension “.&#64;o” is automatic when not included anywhere in the
output file name.  Thus to process the Pt series at <em>Q</em><sub>max</sub> = 18 Å<sup>-1</sup>
while saving the results in the same folder, but with “qmax18” in their
filename can be done with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 -d series --find &quot;&lt;900-910&gt;.chi&quot; --qmax=18 -o series-gr/@b_qmax18
</pre></div>
</div>
<p>The <code class="file docutils literal"><span class="pre">series-gr</span></code> directory should now contain 12 gr files,
6 of them processed at the <em>Q</em><sub>max</sub> = 27 Å<sup>-1</sup> from the configuration
file and 6 other at <em>Q</em><sub>max</sub> = 18 Å<sup>-1</sup>.</p>
</div>
</div>
<div class="section" id="interactive-tuning-of-parameters">
<span id="my-tuneconfig"></span><span id="index-3"></span><h2>Interactive tuning of parameters<a class="headerlink" href="#interactive-tuning-of-parameters" title="Permalink to this headline">¶</a></h2>
<p>One of the most powerful features of PDFgetX3 is the ability to tune
PDF processing parameters in an interactive mode and immediately
visualize their effect on the results.  To demonstrate this feature,
navigate to the <code class="file docutils literal"><span class="pre">examples/Ni</span></code> directory in the shell and process
the nickel PDF while plotting the <em>F</em>(<em>Q</em>) and <em>G</em>(<em>r</em>) curves.
Because of plotting the program will open an interactive IPython
session.  The tuning mode can be then entered by calling the
<a class="reference internal" href="interact.html#_interactive_.tuneconfig" title="_interactive_.tuneconfig"><code class="xref py py-func docutils literal"><span class="pre">tuneconfig()</span></code></a>
function from the IPython environment</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 --plot=fq,gr ni300mesh_300k_nor_1-5.chi
...
In [1]: tuneconfig()
</pre></div>
</div>
<p>The
<code class="xref py py-func docutils literal"><span class="pre">tuneconfig()</span></code>
function will by default add a second set of live lines
for the plotted curves and open a GUI dialog with sliders for the
tunable process parameters.  Changing any slider would immediately
recalculate the PDF and update live lines in the plot.</p>
<img alt="_images/tunenickelfqgr.png" src="_images/tunenickelfqgr.png" />
<p>The <em>constant data scale</em> check-box rescales the result curves to a
constant maximum value.  This is useful for assessing if a parameter
change produces different curve shape or if it just rescales the
results.  The tunable parameters are described in the
<a class="reference internal" href="options.html#my-pdfparameters"><span class="std std-ref">PDF parameters section</span></a>.
Only the active parameters are displayed in the tuneconfig GUI,
thus there would be no slider for the <a class="reference internal" href="options.html#confval-bgscale"><code class="xref std std-confval docutils literal"><span class="pre">bgscale</span></code></a> parameter
if PDF has been processed without any background data.</p>
<p>By default the
<code class="xref py py-func docutils literal"><span class="pre">tuneconfig()</span></code>
function displays the same curves as
specified by the <a class="reference internal" href="options.html#cmdoption-pdfgetx3-p"><code class="xref std std-option docutils literal"><span class="pre">--plot</span></code></a> option, however it can be
configured to show arbitrary intermediate results or even visualize
selected steps in the PDF processing.  We shall demonstrate this by
showing a live-plot of the polynomial correction together with the final
PDF.  At first, we shall use the <code class="xref py py-meth docutils literal"><span class="pre">describe()</span></code> method of the
<a class="reference internal" href="interact.html#_interactive_.pdfgetter" title="_interactive_.pdfgetter"><code class="xref py py-func docutils literal"><span class="pre">pdfgetter()</span></code></a> object to print out the chain of
transformations involved in the PDF processing and obtain a reference to
the transformation object <em>t4</em> that applies the polynomial correction.
The transformation object can be then included in a list of plot
identifiers that are passed to the <code class="xref py py-func docutils literal"><span class="pre">tuneconfig()</span></code> function</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ pdfgetx3 --plot=fq,gr ni300mesh_300k_nor_1-5.chi
...
Use &quot;%pdfgetx3&quot; for a fresh run without exiting IPython.

In [1]: clf()
In [2]: pdfgetter.describe()
0   TransformTwoThetaToQA
    convert x data from twotheta to Q in 1/A
1   TransformQGridRegular
    Remove the data outside the (qmin, qmaxinst) range
2   TransformBackground
    subtract background intensity
3   TransformXrayASFnormChris
    scale and normalize intensities by x-ray scattering factors
4   TransformSQnormRPoly
    Normalize S(Q) by fitting a polynomial
5   TransformSQToFQ
    Convert S(Q) to F(Q).
6   TransformFQgrid
    Resample F(Q) to a regular grid suitable for FFT
7   TransformFQToGr
    Convert F(Q) to G(r).
In [3]: t4 = pdfgetter.getTransformation(4)
In [4]: tuneconfig([t4, &#39;gr&#39;])
</pre></div>
</div>
<p>The <code class="xref py py-func docutils literal"><span class="pre">clf()</span></code> function used above
clears the figure to remove the initial
<em>F</em>(<em>Q</em>) line from the first panel.  Overall, this should display the
following plot:</p>
<img alt="_images/tunenickelt4gr.png" src="_images/tunenickelt4gr.png" />
<p>The tuning can be finished by clicking the <code class="docutils literal"><span class="pre">Done</span></code> button or closing the
tuneconfig GUI window.  The parameter values can be thereafter adjusted
to a rounded values by setting an attribute of the <a class="reference internal" href="interact.html#interactvar-config"><code class="xref std std-interactvar docutils literal"><span class="pre">config</span></code></a>
object, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">config</span><span class="o">.</span><span class="n">bgscale</span> <span class="o">=</span> <span class="mf">1.5</span>
</pre></div>
</div>
<p>Finally, to save the new results, we shall first confirm
<a class="reference internal" href="options.html#confval-outputtypes"><code class="xref std std-confval docutils literal"><span class="pre">outputtypes</span></code></a> have been correctly set and then use the
<a class="reference internal" href="interact.html#_interactive_.processFiles" title="_interactive_.processFiles"><code class="xref py py-func docutils literal"><span class="pre">processFiles()</span></code></a> function to redo the calculations, plots and
data output for the updated configuration.  Note that the
<code class="xref py py-func docutils literal"><span class="pre">processFiles()</span></code> function accepts keyword arguments for
configuration parameters.  This is used at line <code class="docutils literal"><span class="pre">In&nbsp;[8]</span></code> to
turn on the <a class="reference internal" href="options.html#confval-force"><code class="xref std std-confval docutils literal"><span class="pre">force</span></code></a> flag and is in effect a shortcut
for an extra <code class="docutils literal"><span class="pre">config.force</span> <span class="pre">=</span> <span class="pre">True</span></code> statement.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">config</span><span class="o">.</span><span class="n">outputtypes</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="p">[</span><span class="s1">&#39;gr&#39;</span><span class="p">]</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">processFiles</span><span class="p">()</span>
<span class="n">WARNING</span><span class="p">:</span><span class="n">ni300mesh_300k_nor_1</span><span class="o">-</span><span class="mf">5.</span><span class="n">gr</span> <span class="n">already</span> <span class="n">exists</span><span class="o">.</span>
<span class="n">WARNING</span><span class="p">:</span><span class="n">Use</span> <span class="s2">&quot;--force=yes&quot;</span> <span class="ow">or</span> <span class="s2">&quot;--force=once&quot;</span> <span class="n">to</span> <span class="n">overwrite</span><span class="o">.</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">processFiles</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="file docutils literal"><span class="pre">ni300mesh_300k_nor_1-5.gr</span></code> was successfully saved at an
updated configuration for there were no warnings after the last call.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#nickel-x-ray-pdf">Nickel X-ray PDF</a><ul>
<li><a class="reference internal" href="#predefined-configuration-file">predefined configuration file</a></li>
<li><a class="reference internal" href="#processing-from-scratch">processing from scratch</a></li>
</ul>
</li>
<li><a class="reference internal" href="#platinum-data-series">Platinum data series</a><ul>
<li><a class="reference internal" href="#matching-input-files">matching input files</a></li>
<li><a class="reference internal" href="#data-search-path">data search path</a></li>
<li><a class="reference internal" href="#output-file-names">output file names</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interactive-tuning-of-parameters">Interactive tuning of parameters</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="quick-start.html"
                        title="previous chapter">Quick-start guide</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="files.html"
                        title="next chapter">Files used by PDFgetX3</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="files.html" title="Files used by PDFgetX3"
             >next</a> |</li>
        <li class="right" >
          <a href="quick-start.html" title="Quick-start guide"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PDFgetX3 1.2 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Pavol Juhás, Timur Davis, Christopher Farrow, Simon Billinge.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.6.5.
    </div>
  </body>
</html>